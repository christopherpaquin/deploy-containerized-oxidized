###############################################################################
# Oxidized Deployment Configuration
#
# SETUP INSTRUCTIONS:
# ===================
# 1. Copy this file:
#    cp env.example .env
#
# 2. Edit configuration values:
#    vim .env
#
# 3. Secure the file (contains sensitive data):
#    chmod 600 .env
#
# 4. Validate your configuration:
#    ./scripts/validate-env.sh
#
# 5. Deploy:
#    sudo ./scripts/deploy.sh
#
# SECURITY WARNING:
# ================
# - The .env file will contain SENSITIVE INFORMATION (passwords, credentials)
# - NEVER commit .env to Git (already in .gitignore)
# - Keep file permissions restricted: chmod 600 .env
# - Do not share .env file contents
# - Use a secrets manager (Vault, AWS Secrets Manager) in production
#
###############################################################################

# ===========================================================================
# SYSTEM USER CONFIGURATION
# ===========================================================================
# The dedicated Linux user/group that will own all Oxidized data and run
# the container process. This provides isolation and security.
#
# UID/GID 2000 is chosen to avoid conflicts with standard system users
# (typically < 1000) and regular users (typically 1000-60000).
#
# WHEN TO CHANGE:
# - If UID/GID 2000 conflicts with existing users on your system
# - If company policy requires specific UID ranges
# - For multi-tenant deployments requiring separation

OXIDIZED_USER="oxidized"
OXIDIZED_GROUP="oxidized"
OXIDIZED_UID=2000
OXIDIZED_GID=2000
OXIDIZED_HOME="/home/oxidized"


# ===========================================================================
# DIRECTORY CONFIGURATION
# ===========================================================================
# Root directory for all Oxidized data. All subdirectories will be created
# under this path. Must be writable by OXIDIZED_UID:OXIDIZED_GID.
#
# Directory structure created:
# ${OXIDIZED_ROOT}/
# ├── config/     Configuration files
# ├── ssh/        SSH keys for device authentication
# ├── data/       Runtime data and logs
# ├── output/     Backup output files
# └── repo/       Git repository with versioned configs
#
# BEST PRACTICES:
# - Use a dedicated filesystem or mount point
# - Ensure sufficient disk space (10GB minimum for ~100 devices)
# - Consider SSD for better Git performance
# - Include in backup strategy

OXIDIZED_ROOT="/var/lib/oxidized"


# ===========================================================================
# CONTAINER CONFIGURATION
# ===========================================================================
# Container image and runtime settings.
#
# IMAGE VERSION:
# - CRITICAL: Pin to specific version (never use :latest)
# - Format: registry/repository:tag
# - Check available versions: https://hub.docker.com/r/oxidized/oxidized/tags
# - Current stable: 0.30.1
#
# UPGRADE PROCEDURE:
# 1. Check release notes for breaking changes
# 2. Backup data: tar -czf backup.tar.gz ${OXIDIZED_ROOT}
# 3. Update OXIDIZED_IMAGE version below
# 4. Run: sudo ./scripts/deploy.sh
# 5. Verify: sudo ./scripts/health-check.sh

OXIDIZED_IMAGE="docker.io/oxidized/oxidized:0.30.1"
CONTAINER_NAME="oxidized"
PODMAN_NETWORK="oxidized-net"


# ===========================================================================
# CONTAINER BIND MOUNTS
# ===========================================================================
# These define how host directories map to container paths.
# Format: host_path:container_path
#
# WARNING: Do not change container paths unless you know what you're doing.
# The Oxidized application expects specific paths inside the container.
#
# CONTAINER PATH MEANINGS:
# - /home/oxidized/.config/oxidized  = Main config directory
# - /home/oxidized/.ssh              = SSH keys (read-only mount)
# - /home/oxidized/.config/oxidized/data   = Runtime data/logs
# - /home/oxidized/.config/oxidized/output = Backup output
# - /home/oxidized/.config/oxidized/repo   = Git repository
#
# Only change these if you're customizing the container image.

MOUNT_CONFIG="/home/oxidized/.config/oxidized"
MOUNT_SSH="/home/oxidized/.ssh"
MOUNT_DATA="/home/oxidized/.config/oxidized/data"
MOUNT_OUTPUT="/home/oxidized/.config/oxidized/output"
MOUNT_REPO="/home/oxidized/.config/oxidized/repo"


# ===========================================================================
# NETWORK CONFIGURATION
# ===========================================================================
# Network settings for the REST API and Web UI.
#
# API_HOST OPTIONS:
# - "0.0.0.0"  = Listen on all interfaces (accessible from network)
# - "127.0.0.1" = Localhost only (more secure, local access only)
#
# API_PORT:
# - Must be > 1024 for non-root containers
# - Default: 8888
# - Ensure not conflicting with other services
#
# WEB_UI:
# - Set to "true" to enable Web UI
# - Access at: http://your-server:8888
# - WARNING: No authentication by default, use firewall or reverse proxy
#
# SECURITY NOTES:
# - If WEB_UI=true, consider restricting API_HOST to 127.0.0.1
# - Use firewall rules to limit access: firewall-cmd --add-rich-rule=...
# - Consider reverse proxy with authentication (nginx, Apache, Traefik)

OXIDIZED_API_PORT=8888
OXIDIZED_API_HOST="0.0.0.0"
OXIDIZED_WEB_UI="false"


# ===========================================================================
# DEVICE CREDENTIALS
# ===========================================================================
# ⚠️ CRITICAL SECURITY SECTION - CONTAINS SENSITIVE DATA ⚠️
#
# These credentials are used to log into network devices for configuration
# backup. They will be stored in the generated config file.
#
# USERNAME: Device login username
# PASSWORD: Device login password
#
# SECURITY RECOMMENDATIONS:
# 1. IMMEDIATELY change PASSWORD from "changeme"
# 2. Use STRONG, UNIQUE passwords (12+ characters, mixed case, numbers, symbols)
# 3. Consider using SSH KEYS instead of passwords (see SSH CONFIGURATION below)
# 4. Use LEAST-PRIVILEGE accounts on devices (read-only access)
# 5. For production: Use secrets manager (HashiCorp Vault, AWS Secrets Manager)
# 6. Rotate credentials regularly (quarterly recommended)
# 7. Audit device logs for Oxidized access
#
# SSH KEY AUTHENTICATION (preferred over passwords):
# - Generate key: ssh-keygen -t rsa -b 4096 -f ${OXIDIZED_ROOT}/ssh/id_rsa
# - Copy to devices: ssh-copy-id -i ${OXIDIZED_ROOT}/ssh/id_rsa.pub user@device
# - Set ownership: chown 2000:2000 ${OXIDIZED_ROOT}/ssh/id_rsa
# - Set permissions: chmod 600 ${OXIDIZED_ROOT}/ssh/id_rsa
# - Leave PASSWORD empty or set dummy value if using SSH keys only

OXIDIZED_USERNAME="admin"
OXIDIZED_PASSWORD="changeme"


# ===========================================================================
# SSH CONFIGURATION
# ===========================================================================
# SSH key settings for device authentication.
#
# SSH_PRIVATE_KEY: Filename of SSH private key (placed in ${OXIDIZED_ROOT}/ssh/)
# - Leave empty if using password authentication only
# - File must be owned by OXIDIZED_UID:OXIDIZED_GID
# - File must have 600 permissions
#
# SSH_KNOWN_HOSTS: Filename for SSH known_hosts (auto-created if missing)
# - Prevents MITM attacks
# - First connection will add fingerprint automatically
#
# KEY GENERATION EXAMPLE:
# sudo -u oxidized ssh-keygen -t ed25519 \
#   -f ${OXIDIZED_ROOT}/ssh/id_ed25519 \
#   -C "oxidized@$(hostname)"

SSH_PRIVATE_KEY="id_rsa"
SSH_KNOWN_HOSTS="known_hosts"


# ===========================================================================
# GIT CONFIGURATION
# ===========================================================================
# Git settings for version control of device configurations.
#
# Every configuration backup is committed to a local Git repository,
# providing full version history and change tracking.
#
# GIT_USER_NAME: Name for Git commits
# - Appears in: git log output
# - Recommendation: Use descriptive name (e.g., "Oxidized Automation")
#
# GIT_USER_EMAIL: Email for Git commits
# - Appears in: git log output
# - Recommendation: Use monitoring/automation email address
#
# NOTE: These are used for local Git commits only, not authentication.
# The Git repository is stored in ${OXIDIZED_ROOT}/repo/

GIT_USER_NAME="Oxidized"
GIT_USER_EMAIL="oxidized@example.com"


# ===========================================================================
# OPERATIONAL CONFIGURATION
# ===========================================================================
# Runtime behavior and performance settings.
#
# POLL_INTERVAL: Seconds between backup cycles
# - 3600 = hourly backups (recommended for most deployments)
# - 1800 = 30 minutes (for rapidly changing environments)
# - 86400 = daily (for stable environments)
# - WARNING: Values < 300 (5 min) may cause high CPU/network load
#
# THREADS: Number of concurrent device backup threads
# - Recommended: 1.5-2x number of CPU cores
# - Too high: Increased memory usage, potential timeouts
# - Too low: Slower backup cycles for many devices
# - Typical: 30 threads handles 100-200 devices well
#
# TIMEOUT: Seconds to wait for device response
# - Increase for slow/distant devices
# - Decrease for fast local networks
# - Typical range: 10-30 seconds
#
# RETRIES: Number of retry attempts for failed backups
# - Typical: 2-3 retries
# - Set to 0 to disable retries
#
# DEBUG: Enable verbose logging
# - "true" = Debug logging (verbose, for troubleshooting)
# - "false" = Normal logging (recommended for production)
# - WARNING: Debug mode generates LARGE log files
#
# TZ: Timezone for container
# - Used for log timestamps and Git commits
# - Format: IANA timezone (e.g., "America/New_York", "Europe/London")
# - Use "UTC" for standardized timestamps across systems
# - List timezones: timedatectl list-timezones

POLL_INTERVAL=3600
THREADS=30
TIMEOUT=20
RETRIES=3
DEBUG="false"
TZ="UTC"


# ===========================================================================
# RESOURCE LIMITS
# ===========================================================================
# Container resource constraints to prevent runaway processes.
#
# MEMORY_LIMIT: Maximum RAM for container
# - Format: Number + K/M/G suffix (e.g., "1G", "512M", "2048M")
# - Recommendation: 512M minimum, 1G for 100 devices, 2G for 500+ devices
# - Container will be killed if exceeding this limit
#
# CPU_QUOTA: Maximum CPU usage
# - Format: Percentage (e.g., "100%", "200%", "50%")
# - 100% = 1 full CPU core
# - 200% = 2 full CPU cores
# - Recommendation: 100% minimum, 200% for 100+ devices
#
# SIZING GUIDELINES:
# Devices | Memory | CPU   | Notes
# --------|--------|-------|----------------------------------
# < 50    | 512M   | 50%   | Small deployment
# 50-100  | 1G     | 100%  | Medium deployment (default)
# 100-500 | 2G     | 200%  | Large deployment
# 500+    | 4G+    | 400%+ | Enterprise (adjust based on testing)

MEMORY_LIMIT="1G"
CPU_QUOTA="100%"


# ===========================================================================
# ADVANCED CONFIGURATION
# ===========================================================================
# Advanced settings for specific use cases. Most users should not change these.
#
# SELINUX_MOUNT_OPTION: SELinux labeling for bind mounts
# - ":Z" = Exclusive label (recommended, most secure)
# - ":z" = Shared label (if multiple containers access same data)
# - "" = No relabeling (if SELinux disabled)
# - Only change if you understand SELinux implications
#
# EXTRA_PODMAN_OPTS: Additional Podman run options
# - Expert use only
# - Example: "--dns 8.8.8.8 --dns 8.8.4.4"
# - Example: "--add-host device.local:192.168.1.1"
# - Leave empty unless you have specific requirements

SELINUX_MOUNT_OPTION=":Z"
EXTRA_PODMAN_OPTS=""


###############################################################################
# END OF CONFIGURATION
#
# NEXT STEPS:
# ===========================================================================
# 1. Save this file as .env: cp env.example .env
# 2. Edit .env and customize values (especially OXIDIZED_PASSWORD)
# 3. Secure the file: chmod 600 .env
# 4. Validate configuration: ./scripts/validate-env.sh
# 5. Deploy: sudo ./scripts/deploy.sh
# 6. Verify: sudo ./scripts/health-check.sh
#
# DOCUMENTATION:
# ===========================================================================
# - Configuration Guide: docs/CONFIGURATION.md
# - Architecture Details: docs/ENV-ARCHITECTURE.md
# - Security Hardening: docs/SECURITY-HARDENING.md
# - Installation Guide: docs/INSTALL.md
#
# SUPPORT:
# ===========================================================================
# - GitHub Issues: https://github.com/yourusername/deploy-containerized-oxidized
# - Oxidized Docs: https://github.com/yggdrasil-network/oxidized
#
###############################################################################
